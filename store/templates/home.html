{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<!-- Hero Section -->
<section class="hero position-relative overflow-hidden">
    <div class="hero-bg"></div>
    <div class="container position-relative py-5">
        <div class="row min-vh-60 align-items-center">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-3 fw-bold text-white mb-4 animate-up">Welcome to Oja</h1>
                <p class="lead text-white mb-4 animate-up delay-1" style="font-size: 1.3rem;">Your one-stop destination
                    for quality products at amazing prices</p>
                <div class="d-flex gap-3 justify-content-center animate-up delay-2">
                    <a href="#featured-products" class="btn btn-lg px-4"
                        style="background-color: #3498db; color: white; border: none;">
                        <i class="bi bi-cart me-2"></i>Shop Now
                    </a>
                    <a href="{% url 'category_summary' %}" class="btn btn-outline-light btn-lg px-4">
                        <i class="bi bi-grid me-2"></i>Categories
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
<section id="featured-products" class="featured-products py-5">
    <div class="container">
        <!-- Section Header -->
        <div class="row align-items-center mb-4">
            <div class="col-lg-6">
                <h2 class="h2 mb-2">Featured Products</h2>
                <p class="text-muted mb-lg-0">Handpicked selections just for you</p>
            </div>
            <div class="col-lg-6">
                <div class="d-flex gap-3 justify-content-lg-end align-items-center">
                    <!-- Add Search Bar -->
                    <div class="search-container flex-grow-1">
                        <input type="text" class="form-control" id="productSearch" placeholder="Search products...">
                        <div class="search-results shadow-sm" style="display: none;">
                            <div class="search-results-content"></div>
                        </div>
                    </div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-dark active" data-view="grid" title="Grid View">
                            <i class="bi bi-grid-3x3-gap"></i>
                        </button>
                        <button type="button" class="btn btn-outline-dark" data-view="list" title="List View">
                            <i class="bi bi-list-ul"></i>
                        </button>
                    </div>
                    <select class="form-select w-auto" id="sortProducts">
                        <option value="default">Sort by</option>
                        <option value="price_asc">Price: Low to High</option>
                        <option value="price_desc">Price: High to Low</option>
                        <option value="name_asc">Name: A to Z</option>
                        <option value="name_desc">Name: Z to A</option>
                        <option value="newest">Newest First</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3">
                <div class="filters-sidebar">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <!-- Price Range Filter -->
                            <div class="mb-4">
                                <h5 class="mb-3">Price Range</h5>
                                <div class="price-range">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>$<span id="priceMin">0</span></span>
                                        <span>$<span id="priceMax">1000</span></span>
                                    </div>
                                    <div class="range-slider mb-3">
                                        <input type="range" class="form-range" id="priceRangeMin" min="0" max="1000"
                                            value="0">
                                        <input type="range" class="form-range" id="priceRangeMax" min="0" max="1000"
                                            value="1000">
                                    </div>
                                </div>
                            </div>

                            <!-- Category Filter -->
                            <div class="mb-4">
                                <h5 class="mb-3">Categories</h5>
                                <div class="category-filters">
                                    {% for category in categories %}
                                    <div class="form-check mb-2">
                                        <input class="form-check-input category-filter" type="checkbox"
                                            value="{{ category.name }}" id="category{{ category.id }}">
                                        <label class="form-check-label" for="category{{ category.id }}">
                                            {{ category.name }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Sale Items Filter -->
                            <div class="mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="saleItemsOnly">
                                    <label class="form-check-label" for="saleItemsOnly">
                                        Sale Items Only
                                    </label>
                                </div>
                            </div>

                            <!-- Reset Filters -->
                            <button class="btn btn-outline-secondary w-100" id="resetFilters">
                                Reset Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="col-lg-9">
                <div class="row g-4" id="products-container">
                    {% for product in products %}
                    <div class="col-12 col-sm-6 col-md-4 product-item"
                        data-price="{% if product.is_sale %}{{ product.sale_price }}{% else %}{{ product.price }}{% endif %}"
                        data-category="{{ product.category.name }}" data-name="{{ product.name }}"
                        data-sale="{{ product.is_sale|lower }}">
                        {% include 'components/product_card.html' with product=product %}
                    </div>
                    {% endfor %}
                </div>

                <!-- No Results Message -->
                <div id="noResults" class="text-center py-5" style="display: none;">
                    <i class="bi bi-search fs-1 text-muted"></i>
                    <p class="mt-3 mb-0">No products match your filters</p>
                    <button class="btn btn-outline-dark btn-sm mt-3" onclick="$('#resetFilters').click()">
                        Reset Filters
                    </button>
                </div>

                <!-- Pagination -->
                {% if products.has_other_pages %}
                <nav aria-label="Product pagination" class="mt-5">
                    <ul class="pagination justify-content-center">
                        {% if products.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.previous_page_number }}" aria-label="Previous">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        {% endif %}

                        {% for num in products.paginator.page_range %}
                        {% if products.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                        {% endif %}
                        {% endfor %}

                        {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ products.next_page_number }}" aria-label="Next">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="newsletter-content text-center">
                    <div class="newsletter-icon mb-4">
                        <i class="bi bi-envelope-paper-heart"></i>
                    </div>
                    <h3 class="h2 mb-3">Join Our Newsletter</h3>
                    <p class="text-white-50 mb-4">Subscribe to get exclusive offers, special deals, and updates about
                        our latest products!</p>
                    <form class="newsletter-form">
                        <div class="input-group">
                            <input type="email" class="form-control" placeholder="Enter your email address" required>
                            <button class="btn btn-light px-4" type="submit">
                                <i class="bi bi-send me-2"></i>Subscribe
                            </button>
                        </div>
                        <div class="form-check mt-3 text-start">
                            <input class="form-check-input" type="checkbox" id="privacyCheck" required>
                            <label class="form-check-label small text-white-50" for="privacyCheck">
                                I agree to receive marketing emails and accept the privacy policy
                            </label>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function () {
        // Smooth scroll for anchor links
        $('a[href^="#"]').on('click', function (e) {
            e.preventDefault();
            const target = $(this.getAttribute('href'));
            if (target.length) {
                $('html, body').animate({
                    scrollTop: target.offset().top - 80
                }, 800, 'easeOutQuad');
            }
        });

        // Back to top button
        const $backToTop = $('<button>', {
            class: 'back-to-top-btn',
            html: '<i class="bi bi-arrow-up"></i>'
        }).appendTo('body');

        $(window).scroll(function () {
            if ($(this).scrollTop() > 300) {
                $backToTop.addClass('show');
            } else {
                $backToTop.removeClass('show');
            }
        });

        $backToTop.click(function () {
            $('html, body').animate({ scrollTop: 0 }, 800, 'easeOutQuad');
        });

        // Show skeleton loading on page load
        const $container = $('#products-container');
        $container.addClass('loading-skeleton');

        // Remove skeleton after images are loaded
        const $images = $container.find('img');
        let loadedImages = 0;

        $images.each(function () {
            const img = new Image();
            img.onload = function () {
                loadedImages++;
                if (loadedImages === $images.length) {
                    setTimeout(() => {
                        $container.removeClass('loading-skeleton');
                        $container.find('.product-item').each(function (index) {
                            $(this).delay(index * 100).animate({ opacity: 1 }, 500);
                        });
                    }, 500);
                }
            };
            img.src = $(this).attr('src');
        });

        let filterTimeout;
        const $noResults = $('#noResults');
        const $priceMin = $('#priceMin');
        const $priceMax = $('#priceMax');
        const $rangeMin = $('#priceRangeMin');
        const $rangeMax = $('#priceRangeMax');

        // Initialize price range slider
        function updatePriceLabels() {
            $priceMin.text($rangeMin.val());
            $priceMax.text($rangeMax.val());
        }

        // Function to filter products
        function filterProducts() {
            clearTimeout(filterTimeout);

            filterTimeout = setTimeout(() => {
                const minPrice = parseFloat($rangeMin.val());
                const maxPrice = parseFloat($rangeMax.val());
                const selectedCategories = $('.category-filter:checked').map(function () {
                    return $(this).val().toLowerCase();
                }).get();
                const saleOnly = $('#saleItemsOnly').is(':checked');
                const sortValue = $('#sortProducts').val();

                // Add loading state
                $container.addClass('loading');

                let visibleCount = 0;
                const $products = $('.product-item');

                $products.each(function () {
                    const $product = $(this);
                    const price = parseFloat($product.data('price'));
                    const category = $product.data('category').toLowerCase();
                    const isSale = $product.data('sale') === 'true';

                    const matchesPrice = price >= minPrice && price <= maxPrice;
                    const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(category);
                    const matchesSale = !saleOnly || isSale;

                    if (matchesPrice && matchesCategory && matchesSale) {
                        $product.removeClass('filtered-out');
                        visibleCount++;
                    } else {
                        $product.addClass('filtered-out');
                    }
                });

                // Sort visible products
                const $visibleProducts = $products.not('.filtered-out').get();
                $visibleProducts.sort((a, b) => {
                    const $a = $(a);
                    const $b = $(b);

                    switch (sortValue) {
                        case 'price_asc':
                            return parseFloat($a.data('price')) - parseFloat($b.data('price'));
                        case 'price_desc':
                            return parseFloat($b.data('price')) - parseFloat($a.data('price'));
                        case 'name_asc':
                            return $a.data('name').localeCompare($b.data('name'));
                        case 'name_desc':
                            return $b.data('name').localeCompare($a.data('name'));
                        case 'newest':
                            return $b.data('id') - $a.data('id');
                        default:
                            return 0;
                    }
                });

                // Update DOM with sorted products
                $container.append($visibleProducts);

                // Show/hide no results message
                $noResults.toggle(visibleCount === 0);

                // Remove loading state
                setTimeout(() => {
                    $container.removeClass('loading');
                }, 300);

                // Update product count
                $('.products-count').text(`${visibleCount} product${visibleCount !== 1 ? 's' : ''}`);
            }, 200);
        }

        // Price range slider events
        $rangeMin.on('input', function () {
            const minVal = parseFloat($(this).val());
            const maxVal = parseFloat($rangeMax.val());

            if (minVal > maxVal) {
                $(this).val(maxVal);
            }

            updatePriceLabels();
            filterProducts();
        });

        $rangeMax.on('input', function () {
            const maxVal = parseFloat($(this).val());
            const minVal = parseFloat($rangeMin.val());

            if (maxVal < minVal) {
                $(this).val(minVal);
            }

            updatePriceLabels();
            filterProducts();
        });

        // Category and sale filters
        $('.category-filter, #saleItemsOnly').on('change', filterProducts);

        // Sort products
        $('#sortProducts').on('change', filterProducts);

        // Reset filters
        $('#resetFilters').click(function () {
            $rangeMin.val(0);
            $rangeMax.val(1000);
            $('.category-filter').prop('checked', false);
            $('#saleItemsOnly').prop('checked', false);
            $('#sortProducts').val('default');
            updatePriceLabels();
            filterProducts();
            createToast('Filters have been reset', 'info');
        });

        // Initialize filters
        updatePriceLabels();
        filterProducts();

        // View switching (Grid/List)
        $('[data-view]').click(function () {
            const view = $(this).data('view');
            $('[data-view]').removeClass('active');
            $(this).addClass('active');

            $container.fadeOut(150, function () {
                if (view === 'list') {
                    $container.addClass('list-view');
                } else {
                    $container.removeClass('list-view');
                }
                $container.fadeIn(150);
            });
        });

        // Newsletter form handling
        $('.newsletter-form').on('submit', function (e) {
            e.preventDefault();
            const $form = $(this);
            const $submitBtn = $form.find('button[type="submit"]');
            const $email = $form.find('input[type="email"]');

            if (!$form[0].checkValidity()) {
                $form.addClass('was-validated');
                return;
            }

            // Disable form during submission
            $submitBtn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span>Subscribing...');

            // Simulate form submission (replace with actual API call)
            setTimeout(() => {
                $form[0].reset();
                $form.removeClass('was-validated');
                $submitBtn.prop('disabled', false).html('<i class="bi bi-send me-2"></i>Subscribe');
                showToast('Thank you for subscribing!', 'success');
            }, 1500);
        });

        // Add new search functionality
        const $searchInput = $('#productSearch');
        const $searchResults = $('.search-results');
        const $searchResultsContent = $('.search-results-content');
        let searchTimeout;

        function performSearch(query) {
            const $products = $('.product-item');
            const results = [];

            $products.each(function () {
                const $product = $(this);
                const name = $product.data('name').toLowerCase();
                const category = $product.data('category').toLowerCase();
                const price = parseFloat($product.data('price'));
                const isSale = $product.data('sale') === true;

                if (name.includes(query) || category.includes(query)) {
                    results.push({
                        name: $product.data('name'),
                        price: price,
                        isSale: isSale,
                        salePrice: isSale ? price : null,
                        regularPrice: isSale ? parseFloat($product.find('.text-decoration-line-through').text().replace('$', '')) : price,
                        image: $product.find('img').first().attr('src'),
                        category: $product.data('category'),
                        element: $product
                    });
                }
            });

            return results;
        }

        function displaySearchResults(results) {
            if (results.length === 0) {
                $searchResultsContent.html(`
                    <div class="search-no-results">
                        <i class="bi bi-search mb-2 d-block"></i>
                        No products found
                    </div>
                `);
            } else {
                const html = results.map(product => `
                    <div class="search-result-item" data-product-id="${product.element.attr('id')}">
                        <img src="${product.image}" alt="${product.name}" class="search-result-img">
                        <div class="search-result-info">
                            <div class="search-result-name">${product.name}</div>
                            <div class="search-result-price">
                                ${product.isSale
                        ? `<span class="sale-price">$${product.salePrice.toFixed(2)}</span> 
                                       <span class="text-decoration-line-through">$${product.regularPrice.toFixed(2)}</span>`
                        : `$${product.price.toFixed(2)}`}
                            </div>
                            <small class="text-muted">${product.category}</small>
                        </div>
                    </div>
                `).join('');
                $searchResultsContent.html(html);
            }
        }

        $searchInput.on('input', function () {
            const query = $(this).val().toLowerCase().trim();

            clearTimeout(searchTimeout);

            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    const results = performSearch(query);
                    displaySearchResults(results);
                    $searchResults.show();
                }, 300);
            } else {
                $searchResults.hide();
            }
        });

        $(document).on('click', '.search-result-item', function () {
            const productId = $(this).data('product-id');
            const $product = $(`#${productId}`);

            // Scroll to product and highlight it
            $('html, body').animate({
                scrollTop: $product.offset().top - 100
            }, 500);

            $product.addClass('highlight-product');
            setTimeout(() => $product.removeClass('highlight-product'), 2000);

            $searchResults.hide();
            $searchInput.val('');
        });

        // Close search results when clicking outside
        $(document).on('click', function (e) {
            if (!$(e.target).closest('.search-container').length) {
                $searchResults.hide();
            }
        });
    });
</script>

<style>
    /* Hero Section */
    .hero {
        background-color: #2c3e50;
        margin-top: -60px;
        position: relative;
        overflow: hidden;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(44, 62, 80, 0.97) 0%, rgba(52, 152, 219, 0.85) 100%);
        z-index: 1;
    }

    .hero-bg {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        background: url('{% static "assets/hero-bg.jpg" %}') center/cover;
        opacity: 0.15;
        animation: scale-bg 20s infinite alternate;
    }

    .hero .container {
        z-index: 2;
    }

    .min-vh-60 {
        min-height: 70vh;
    }

    @keyframes scale-bg {
        from {
            transform: scale(1);
        }

        to {
            transform: scale(1.1);
        }
    }

    .animate-up {
        transform: translateY(30px);
        opacity: 0;
        animation: float-up 0.8s ease forwards;
    }

    .delay-1 {
        animation-delay: 0.3s;
    }

    .delay-2 {
        animation-delay: 0.6s;
    }

    @keyframes float-up {
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Featured Products Section */
    .featured-products {
        background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
        border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .product-item {
        transition: transform 0.3s ease;
    }

    .product-item:hover {
        transform: translateY(-5px);
    }

    /* View Toggles */
    .btn-group .btn {
        padding: 0.5rem 1rem;
    }

    .btn-group .btn i {
        font-size: 1.1rem;
    }

    /* Sort Dropdown */
    #sortProducts {
        min-width: 180px;
        border-color: #dee2e6;
    }

    /* Pagination */
    .pagination {
        gap: 0.5rem;
    }

    .pagination .page-link {
        color: #2c3e50;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-weight: 500;
    }

    .pagination .page-item.active .page-link {
        background-color: #3498db;
        color: white;
    }

    .pagination .page-link:hover {
        background-color: #e9ecef;
        color: #2c3e50;
    }

    /* List View Styles */
    .list-view .product-item {
        transform: none !important;
    }

    /* Newsletter Section */
    .newsletter-section {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        position: relative;
        overflow: hidden;
    }

    .newsletter-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="white" fill-opacity="0.05" x="0" y="0" width="100" height="100"/></svg>') repeat;
        opacity: 0.1;
    }

    .newsletter-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .newsletter-icon i {
        font-size: 2.5rem;
        color: rgba(255, 255, 255, 0.9);
    }

    .newsletter-form .form-control {
        border: none;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.9);
    }

    .newsletter-form .form-control:focus {
        background: white;
        box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.25);
    }

    .newsletter-form .btn {
        padding: 0.75rem 2rem;
        font-weight: 500;
        background: white;
        color: #2c3e50;
        border: none;
        transition: all 0.3s ease;
    }

    .newsletter-form .btn:hover {
        background: #f8f9fa;
        transform: translateX(5px);
    }

    .form-check-input:checked {
        background-color: white;
        border-color: white;
    }

    @media (max-width: 768px) {
        .hero {
            text-align: center;
        }

        .hero-bg {
            opacity: 0.15;
        }

        .min-vh-60 {
            min-height: 50vh;
        }

        .newsletter-icon {
            width: 60px;
            height: 60px;
        }

        .newsletter-icon i {
            font-size: 2rem;
        }
    }

    /* Product Grid Transitions */
    #products-container {
        position: relative;
        transition: opacity 0.3s ease;
    }

    #products-container.switching-view {
        opacity: 0.5;
    }

    #products-container.loading {
        opacity: 0.7;
    }

    #products-container.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: translate(-50%, -50%) rotate(0deg);
        }

        100% {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }

    /* Newsletter Form Validation */
    .newsletter-form .form-control.is-invalid {
        background-image: none;
        border-color: #dc3545;
        box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }

    .newsletter-form .form-control.is-valid {
        background-image: none;
        border-color: #198754;
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
    }

    .newsletter-form .invalid-feedback {
        color: #ffc107;
    }

    /* Enhanced Mobile Responsiveness */
    @media (max-width: 768px) {
        .featured-products .row>div {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        #sortProducts {
            min-width: 140px;
        }

        .btn-group .btn {
            padding: 0.4rem 0.8rem;
        }
    }

    @media (max-width: 576px) {
        .featured-products .row {
            margin-left: -0.25rem;
            margin-right: -0.25rem;
        }

        .featured-products .row>div {
            padding-left: 0.25rem;
            padding-right: 0.25rem;
        }
    }

    /* Back to Top Button */
    .back-to-top-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 45px;
        height: 45px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .back-to-top-btn.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .back-to-top-btn:hover {
        background: #2980b9;
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    /* Skeleton Loading */
    .loading-skeleton .product-item {
        opacity: 0;
    }

    .loading-skeleton .card {
        background: #f8f9fa;
        position: relative;
        overflow: hidden;
    }

    .loading-skeleton .card::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        animation: shimmer 2s infinite;
        background: linear-gradient(90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.4) 50%,
                rgba(255, 255, 255, 0) 100%);
        transform: translateX(-100%);
    }

    .loading-skeleton .product-img-container {
        background: #eee;
    }

    .loading-skeleton .card-body {
        position: relative;
    }

    .loading-skeleton .card-title,
    .loading-skeleton .card-text,
    .loading-skeleton .price-container {
        background: #eee;
        height: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 4px;
    }

    .loading-skeleton .card-title {
        height: 1.5rem;
        width: 80%;
    }

    .loading-skeleton .card-text {
        height: 3rem;
    }

    .loading-skeleton .price-container {
        width: 40%;
    }

    @keyframes shimmer {
        100% {
            transform: translateX(100%);
        }
    }

    /* Enhanced Mobile Responsiveness */
    @media (max-width: 768px) {
        .back-to-top-btn {
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }
    }

    /* Price Range Slider */
    .range-slider {
        position: relative;
        height: 30px;
        padding: 5px 0;
    }

    .range-slider::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 2px;
        background: #e9ecef;
        top: 50%;
        transform: translateY(-50%);
    }

    .range-slider input[type="range"] {
        position: absolute;
        width: 100%;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background: none;
        pointer-events: none;
        top: 50%;
        transform: translateY(-50%);
        z-index: 2;
    }

    .range-slider input[type="range"]::-webkit-slider-thumb {
        height: 18px;
        width: 18px;
        border-radius: 50%;
        border: 2px solid #3498db;
        background: #fff;
        pointer-events: auto;
        -webkit-appearance: none;
        cursor: pointer;
        margin-top: -8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
        transition: transform 0.1s ease;
    }

    .range-slider input[type="range"]::-moz-range-thumb {
        height: 18px;
        width: 18px;
        border-radius: 50%;
        border: 2px solid #3498db;
        background: #fff;
        pointer-events: auto;
        -moz-appearance: none;
        cursor: pointer;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
        transition: transform 0.1s ease;
    }

    .range-slider input[type="range"]::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }

    .range-slider input[type="range"]::-moz-range-thumb:hover {
        transform: scale(1.1);
    }

    .range-slider input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 2px;
        background: none;
        border: none;
    }

    .range-slider input[type="range"]::-moz-range-track {
        width: 100%;
        height: 2px;
        background: none;
        border: none;
    }

    /* Active range bar color */
    .range-slider .range-selected {
        position: absolute;
        height: 2px;
        background: #3498db;
        top: 50%;
        transform: translateY(-50%);
        z-index: 1;
    }

    /* Price labels */
    .price-range .d-flex span {
        font-size: 0.9rem;
        font-weight: 500;
        color: #6c757d;
    }

    #priceMin,
    #priceMax {
        color: #2c3e50;
        font-weight: 600;
    }

    /* Custom Checkbox Styles */
    .form-check-input {
        width: 18px;
        height: 18px;
        margin-top: 0.25em;
        vertical-align: top;
        background-color: #fff;
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
        border: 2px solid #2c3e50;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;
        position: relative;
    }

    .form-check-input:checked {
        background-color: #2c3e50;
        border-color: #2c3e50;
    }

    .form-check-input:checked::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 1px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }

    .form-check-input:focus {
        box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.25);
        border-color: #2c3e50;
    }

    .form-check-label {
        cursor: pointer;
        padding-left: 0.5rem;
    }

    /* Category Filters Scrollbar */
    .category-filters::-webkit-scrollbar {
        width: 6px;
    }

    .category-filters::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
    }

    .category-filters::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
    }

    .category-filters::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }

    /* Add new styles for filtered items */
    .product-item.filtered-out {
        display: none !important;
    }

    /* Loading state styles */
    #products-container.loading {
        opacity: 0.6;
        pointer-events: none;
    }

    #products-container.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    /* Transition styles */
    .product-item {
        transition: opacity 0.3s ease;
    }

    /* List view enhancements */
    .list-view .product-item {
        width: 100% !important;
    }

    .list-view .card {
        flex-direction: row;
    }

    .list-view .product-img-container {
        width: 200px;
        min-width: 200px;
        margin: 0;
    }

    .list-view .card-body {
        display: flex;
        flex-direction: column;
    }

    @media (max-width: 768px) {
        .list-view .card {
            flex-direction: column;
        }

        .list-view .product-img-container {
            width: 100%;
            padding-top: 75%;
        }
    }

    /* Add new search styles */
    .search-container {
        position: relative;
        max-width: 300px;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 0.5rem;
        margin-top: 0.5rem;
        z-index: 1000;
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .search-result-item {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .search-result-item:last-child {
        border-bottom: none;
    }

    .search-result-item:hover {
        background-color: #f8f9fa;
    }

    .search-result-img {
        width: 40px;
        height: 40px;
        border-radius: 0.25rem;
        object-fit: cover;
        margin-right: 1rem;
    }

    .search-result-info {
        flex-grow: 1;
    }

    .search-result-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
        color: #2c3e50;
    }

    .search-result-price {
        font-size: 0.875rem;
        color: #6c757d;
    }

    .search-result-price .sale-price {
        color: #dc3545;
        font-weight: 500;
    }

    .search-no-results {
        padding: 1rem;
        text-align: center;
        color: #6c757d;
    }

    @media (max-width: 991.98px) {
        .search-container {
            max-width: 100%;
        }
    }

    /* Loading State */
    #products-container.loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    #products-container.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% {
            transform: translate(-50%, -50%) rotate(0deg);
        }

        100% {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }

    .filtered-out {
        display: none !important;
    }

    /* Enhanced Filter Styles */
    .filters-sidebar .card {
        position: sticky;
        top: 1rem;
    }

    .price-range {
        padding: 0.5rem 0;
    }

    .category-filters {
        max-height: 200px;
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    .category-filters::-webkit-scrollbar {
        width: 4px;
    }

    .category-filters::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    .category-filters::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .category-filters::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>
{% endblock %}